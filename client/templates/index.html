<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SECURE.NET // ENCRYPTED COMMS</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #0a0a0a;
            --panel-bg: #111111;
            --primary-color: #00ff9d; /* Neon Yeşil */
            --secondary-color: #7000ff; /* Neon Mor */
            --text-color: #e0e0e0;
            --border-color: #333;
            --error-color: #ff0055;
            --disabled-color: #333;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: 
                linear-gradient(rgba(0, 255, 157, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 157, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .cyber-container {
            width: 100%;
            max-width: 850px;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.1);
            position: relative;
            overflow: hidden;
            margin: 20px;
        }

        .cyber-header {
            background: #1a1a1a;
            padding: 15px 25px;
            border-bottom: 1px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--primary-color);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--primary-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .content { padding: 30px; }

        .grid-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }

        label {
            display: block;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cyber-input {
            width: 100%;
            background: #050505;
            border: 1px solid var(--border-color);
            color: var(--primary-color);
            padding: 12px 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            transition: 0.3s;
            box-sizing: border-box;
        }

        .cyber-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.1);
        }

        /* DİSABLED DURUMU İÇİN STİL (YENİ) */
        .cyber-input:disabled {
            background: #0f0f0f;
            color: #444;
            border-color: #222;
            cursor: not-allowed;
            box-shadow: none;
        }

        select.cyber-input { cursor: pointer; appearance: none; }
        
        optgroup { color: var(--secondary-color); font-weight: bold; }
        option { color: var(--text-color); background: #000; }

        .file-drop-zone {
            border: 2px dashed var(--border-color);
            padding: 30px;
            text-align: center;
            transition: 0.3s;
            cursor: pointer;
            position: relative;
            background: rgba(255, 255, 255, 0.02);
        }

        .file-drop-zone:hover {
            border-color: var(--secondary-color);
            background: rgba(112, 0, 255, 0.05);
        }

        .file-icon { font-size: 2rem; color: #666; margin-bottom: 10px; }
        .file-text { color: #888; font-size: 0.9rem; }

        .action-bar { display: flex; gap: 15px; margin-top: 30px; }

        .cyber-btn {
            flex: 1;
            padding: 15px;
            border: none;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn-encrypt {
            background: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-encrypt:hover {
            background: var(--primary-color);
            color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.4);
        }

        .btn-send {
            background: transparent;
            border: 1px solid var(--secondary-color);
            color: var(--secondary-color);
        }

        .btn-send:hover {
            background: var(--secondary-color);
            color: #fff;
            box-shadow: 0 0 20px rgba(112, 0, 255, 0.4);
        }
        
        .btn-send:disabled {
            border-color: #444;
            color: #444;
            cursor: not-allowed;
            box-shadow: none;
            background: transparent;
        }

        .terminal-output {
            margin-top: 30px;
            background: #000;
            border: 1px solid #333;
            padding: 20px;
            font-size: 0.85rem;
            display: none;
            border-left: 3px solid var(--primary-color);
        }

        .log-line { margin-bottom: 8px; display: flex; }
        .log-prefix { color: var(--primary-color); margin-right: 10px; min-width: 80px; }
        .log-content { color: #ccc; word-break: break-all; }
        .log-success { color: var(--primary-color); }
        .log-error { color: var(--error-color); }
        .log-info { color: var(--secondary-color); }

        .key-group { display: flex; gap: 10px; }
        .btn-random {
            background: #222;
            border: 1px solid #444;
            color: #fff;
            cursor: pointer;
            padding: 0 15px;
            font-family: inherit;
        }
        .btn-random:hover { border-color: var(--text-color); }

    </style>
</head>
<body>

<div class="cyber-container">
    <div class="cyber-header">
        <div class="brand"><i class="fas fa-shield-alt"></i> SECURE.NET</div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <span style="font-size: 0.7rem; color: #666;">SERVER STATUS</span>
            <div class="status-dot"></div>
        </div>
    </div>

    <div class="content">
        <div class="grid-row">
            <div>
                <label>ENCRYPTION PROTOCOL</label>
                <select id="algorithm" class="cyber-input" onchange="resetForm()">
                    <optgroup label="-- MODERN --">
                        <option value="aes" selected>AES-128 (Modern Standard)</option>
                        <option value="des">DES-64 (Legacy)</option>
                    </optgroup>
                    <optgroup label="-- CLASSICAL --">
                        <option value="sezar">CAESAR Cipher</option>
                        <option value="vigenere">VIGENERE Cipher</option>
                        <option value="affine">AFFINE Cipher</option>
                        <option value="rail_fence">RAIL FENCE</option>
                        <option value="substitution">SUBSTITUTION</option>
                        <option value="columnar">COLUMNAR Transposition</option>
                        <option value="hill">HILL Cipher (Matrix)</option>
                        <option value="polybius">POLYBIUS Square</option>
                        <option value="playfair">PLAYFAIR Cipher</option>
                        <option value="vernam">VERNAM (One-Time Pad)</option>
                        <option value="root">ROOT / ROUTE Cipher</option>
                    </optgroup>
                </select>
            </div>
            <div>
                <label>EXECUTION MODE</label>
                <select id="mode" class="cyber-input" onchange="resetForm()">
                    <option value="lib">LIBRARY (Optimized)</option>
                    <option value="manual">MANUAL (Educational)</option>
                </select>
            </div>
        </div>

        <div style="margin-bottom: 25px;">
            <label>DATA INPUT</label>
            <div class="file-drop-zone" onclick="document.getElementById('fileInput').click()">
                <i class="fas fa-file-import file-icon"></i>
                <div class="file-text">CLICK TO UPLOAD FILE OR TYPE BELOW</div>
                <div id="file-name-display" style="color: var(--primary-color); margin-top:5px; font-size:0.8rem;"></div>
                <input type="file" id="fileInput" onchange="handleFileUpload()" style="display: none;">
            </div>
            <textarea id="text" class="cyber-input" rows="3" style="margin-top: 10px; border-top: none;" placeholder="// Enter text message data here..."></textarea>
        </div>

        <div style="margin-bottom: 25px;">
            <label>ENCRYPTION KEY</label>
            <div class="key-group">
                <input type="text" id="key" class="cyber-input" placeholder="ENTER SECRET KEY">
                <button onclick="generateRandomKey()" class="btn-random"><i class="fas fa-dice"></i> GEN</button>
            </div>
        </div>

        <div class="action-bar">
            <button onclick="performEncrypt()" id="encryptBtn" class="cyber-btn btn-encrypt">
                <i class="fas fa-lock"></i> ENCRYPT DATA
            </button>
            <button onclick="sendToServer()" id="sendBtn" class="cyber-btn btn-send" disabled>
                <i class="fas fa-paper-plane"></i> TRANSMIT
            </button>
        </div>

        <div id="result-area" class="terminal-output">
            <div class="log-line">
                <span class="log-prefix">> SYSTEM:</span>
                <span class="log-content">Ready for operation...</span>
            </div>
            <div id="dynamic-logs"></div>
        </div>
    </div>
</div>

<script>
    let currentCiphertext = "";
    let currentEncryptedKey = null;
    let selectedFilename = null;

    window.onload = function() {
        updateModeVisibility();
    };

    function addLog(label, text, type="normal") {
        const logContainer = document.getElementById('dynamic-logs');
        const colorClass = type === 'success' ? 'log-success' : (type === 'error' ? 'log-error' : (type === 'info' ? 'log-info' : ''));
        const html = `<div class="log-line"><span class="log-prefix">> ${label}:</span><span class="log-content ${colorClass}">${text}</span></div>`;
        logContainer.innerHTML += html;
    }

    function clearLogs() {
        document.getElementById('dynamic-logs').innerHTML = '';
        document.getElementById('result-area').style.display = 'block';
    }

    function handleFileUpload() {
        const file = document.getElementById('fileInput').files[0];
        if (file) {
            selectedFilename = file.name;
            document.getElementById('file-name-display').innerText = `[FILE LOADED]: ${file.name} (${(file.size/1024).toFixed(1)} KB)`;
            const reader = new FileReader();
            reader.onload = function(e) { document.getElementById('text').value = e.target.result.split(',')[1]; };
            reader.readAsDataURL(file);
        }
    }
    function updateModeVisibility() {
        const algo = document.getElementById('algorithm').value;
        const modeSelect = document.getElementById('mode');

        if (algo === 'aes' || algo === 'des') {
            modeSelect.disabled = false;

        } else {

            modeSelect.value = 'manual';
            modeSelect.disabled = true;
        }
    }

    function resetForm() {
        updateModeVisibility(); // Mod seçimini güncelle
        document.getElementById('sendBtn').disabled = true;
        document.getElementById('result-area').style.display = 'none';
        document.getElementById('dynamic-logs').innerHTML = '';
    }

    async function generateRandomKey() {
        const algo = document.getElementById('algorithm').value;
        const len = document.getElementById('text').value.length;
        try {
            const res = await fetch('/generate_key', {
                method: 'POST', 
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ algorithm: algo, text_length: len })
            });
            const data = await res.json();
            if(data.status === 'success') document.getElementById('key').value = data.key;
        } catch(e) { alert(e); }
    }

    async function performEncrypt() {
        clearLogs();
        addLog('PROCESS', 'Initializing encryption module...');
        
        const algo = document.getElementById('algorithm').value;
        const mode = document.getElementById('mode').value;
        const text = document.getElementById('text').value;
        const key = document.getElementById('key').value;

        if(!key || !text) { addLog('ERROR', 'Missing Input Data', 'error'); return; }

        document.getElementById('encryptBtn').innerHTML = '<i class="fas fa-cog fa-spin"></i> PROCESSING';

        try {
            const res = await fetch('/encrypt', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ algorithm: algo, mode: mode, text: text, key: key })
            });
            const result = await res.json();

            if(result.status === 'success') {
                currentCiphertext = result.ciphertext;
                currentEncryptedKey = result.encrypted_key;
                
                addLog('TIME', `${result.duration}s`, 'info');
                addLog('CIPHER', result.ciphertext.substring(0, 60) + '...', 'success');
                if(result.encrypted_key) addLog('KEY_ENC', 'RSA Enveloped Key Generated', 'info');
                
                document.getElementById('sendBtn').disabled = false;
            } else {
                addLog('ERROR', result.message, 'error');
            }
        } catch(e) { addLog('FATAL', e, 'error'); }
        finally { document.getElementById('encryptBtn').innerHTML = '<i class="fas fa-lock"></i> ENCRYPT DATA'; }
    }

    async function sendToServer() {
        addLog('NETWORK', 'Establishing secure handshake...', 'info');
        document.getElementById('sendBtn').innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> SENDING';
        
        const algo = document.getElementById('algorithm').value;
        const key = document.getElementById('key').value;

        try {
            const res = await fetch('/send_to_server', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    algorithm: algo,
                    mode: document.getElementById('mode').value,
                    ciphertext: currentCiphertext,
                    encrypted_key: currentEncryptedKey,
                    client_key: key,
                    filename: selectedFilename
                })
            });
            const result = await res.json();

            if(result.status === 'success') {
                addLog('SERVER', 'Packet Acknowledged.', 'success');
                addLog('DECRYPT', result.plaintext.substring(0, 50) + '...', 'normal');
                addLog('REPLY', result.server_reply_decrypted, 'info');
                if(result.server_key_used) addLog('NEW_KEY', `Key Update: ${result.server_key_used}`, 'info');
            } else {
                addLog('REMOTE_ERR', result.message, 'error');
            }
        } catch(e) { addLog('NET_ERR', 'Connection Lost', 'error'); }
        finally { document.getElementById('sendBtn').innerHTML = '<i class="fas fa-paper-plane"></i> TRANSMIT'; }
    }
</script>

</body>
</html>