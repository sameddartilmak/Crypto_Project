<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kriptoloji Projesi - Client</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Kodlarƒ± (Deƒüi≈üiklik Yok) */
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); margin: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; color: #333; }
        .container { width: 100%; max-width: 700px; background: #ffffff; padding: 40px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); margin: 20px; }
        h1 { text-align: center; color: #1e3c72; margin-bottom: 30px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; border-bottom: 2px solid #f0f0f0; padding-bottom: 15px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; font-size: 0.9rem; }
        select, input, textarea { width: 100%; padding: 12px 15px; border: 2px solid #e1e1e1; border-radius: 10px; box-sizing: border-box; font-family: 'Poppins', sans-serif; font-size: 1rem; transition: all 0.3s ease; background-color: #f9f9f9; }
        select:focus, input:focus, textarea:focus { border-color: #2a5298; background-color: #fff; outline: none; box-shadow: 0 0 0 4px rgba(42, 82, 152, 0.1); }
        textarea { resize: vertical; }
        small { display: block; margin-top: 5px; font-size: 0.85rem; color: #888; }
        .row { display: flex; gap: 20px; }
        .col { flex: 1; }
        .btn-group { display: flex; gap: 15px; margin-top: 25px; }
        button { flex: 1; padding: 14px; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #encryptBtn { background: linear-gradient(45deg, #11998e, #38ef7d); color: white; }
        #encryptBtn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(56, 239, 125, 0.3); }
        #sendBtn { background: linear-gradient(45deg, #2a5298, #4a90e2); color: white; }
        #sendBtn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(74, 144, 226, 0.4); }
        button:disabled { background: #d6d6d6; color: #888; cursor: not-allowed; box-shadow: none; transform: none; }
        #result-area { margin-top: 30px; padding: 20px; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 12px; display: none; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #result-area h3 { margin-top: 0; color: #1e3c72; font-size: 1.1rem; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .result-row { margin-bottom: 15px; display: flex; flex-direction: column; }
        .result-label { font-size: 0.85rem; font-weight: bold; color: #666; margin-bottom: 5px; text-transform: uppercase; }
        .result-value { font-family: 'Roboto Mono', monospace; background: #2d3436; color: #00cec9; padding: 10px; border-radius: 6px; word-break: break-all; font-size: 0.95rem; letter-spacing: 0.5px; }
        .status-success { color: #00b894; font-weight: bold; }
        .status-error { color: #d63031; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>üõ°Ô∏è Kriptoloji Client</h1>
    
    <div class="row">
        <div class="col form-group">
            <label for="algorithm">Algoritma</label>
            <select id="algorithm" onchange="resetForm()">
                <optgroup label="Modern ≈ûifreleme (√ñdev)">
                    <option value="aes" selected>AES-128</option>
                    <option value="des">DES-64</option>
                </optgroup>
                <optgroup label="Klasik ≈ûifreleme">
                    <option value="sezar">Sezar (Caesar)</option>
                    <option value="vigenere">Vigenere</option>
                    <option value="affine">Affine</option>
                    <option value="rail_fence">Rail Fence</option>
                    <option value="substitution">Substitution</option>
                    <option value="columnar">Columnar Transposition</option>
                    <option value="hill">Hill Cipher (Matris)</option>
                </optgroup>
            </select>
        </div>
        <div class="col form-group">
            <label for="mode">√áalƒ±≈üma Modu</label>
            <select id="mode" onchange="resetForm()">
                <option value="lib">K√ºt√ºphane (Library)</option>
                <option value="manual">Manuel (Eƒüitim)</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label for="text">≈ûifrelenecek Metin</label>
        <textarea id="text" rows="3" placeholder="Gizli mesajƒ±nƒ±zƒ± buraya yazƒ±n..."></textarea>
    </div>

    <div class="form-group">
        <label for="key">Anahtar (Key)</label>
        <input type="text" id="key" placeholder="16 Karakterlik Anahtar (AES)">
        <small id="key-hint">L√ºtfen 16 karakter giriniz (Eksikse tamamlanƒ±r).</small>
    </div>

    <div class="btn-group">
        <button onclick="performEncrypt()" id="encryptBtn">
            üîí 1. ≈ûifrele
        </button>
        <button onclick="sendToServer()" id="sendBtn" disabled>
            üöÄ 2. Server'a G√∂nder
        </button>
    </div>

    <div id="result-area">
        <h3>Sonu√ß Konsolu</h3>
        
        <div class="result-row">
            <span class="result-label">Olu≈üturulan ≈ûifreli Metin (Ciphertext):</span>
            <div id="cipher-result" class="result-value">-</div>
        </div>

        <div class="result-row" id="enc-key-row" style="display:none;">
            <span class="result-label">RSA ile ≈ûifrelenmi≈ü Anahtar (Digital Envelope):</span>
            <div id="enc-key-result" class="result-value" style="color: #fdcb6e; font-size: 0.8rem;">-</div>
        </div>

        <div class="result-row" style="border-top: 1px dashed #ccc; padding-top: 10px;">
            <span class="result-label">Server Baƒülantƒ± Durumu:</span>
            <span id="server-status">-</span>
        </div>

        <div class="result-row">
            <span class="result-label">Server Tarafƒ±ndan √á√∂z√ºlen Metin (Plaintext):</span>
            <div id="server-plaintext" class="result-value" style="color: #fab1a0;">-</div>
        </div>
    </div>
</div>

<script>
    let currentCiphertext = "";
    let currentEncryptedKey = null;

    // Sayfa y√ºklendiƒüinde
    window.onload = function() {
        updatePlaceholder();
    };

    function resetForm() {
        updatePlaceholder();
        document.getElementById('sendBtn').disabled = true;
        document.getElementById('result-area').style.display = 'none';
        document.getElementById('cipher-result').innerText = "-";
        document.getElementById('enc-key-result').innerText = "-";
        document.getElementById('enc-key-row').style.display = 'none';
        currentCiphertext = "";
        currentEncryptedKey = null;
    }

    function updatePlaceholder() {
        const algo = document.getElementById('algorithm').value;
        const hint = document.getElementById('key-hint');
        const keyInput = document.getElementById('key');
        const modeSelect = document.getElementById('mode');
        
        // RSA artƒ±k yok, bu y√ºzden anahtar alanƒ± her zaman aktif
        keyInput.disabled = false;
            
        // 1. Modern ≈ûifreler (AES/DES - Mod Se√ßimi Aktif)
        if(algo === 'aes' || algo === 'des') {
            modeSelect.disabled = false;
            if(algo === 'aes') { 
                hint.innerText = "16 karakter giriniz (Server'a RSA ile ≈üifreli gider)."; 
                keyInput.placeholder = "16 Karakterlik Anahtar";
                keyInput.setAttribute("maxlength", "16");
                keyInput.type = "text";
            }
            else { // des
                hint.innerText = "8 karakter giriniz (Server'a RSA ile ≈üifreli gider)."; 
                keyInput.placeholder = "8 Karakterlik Anahtar";
                keyInput.setAttribute("maxlength", "8");
                keyInput.type = "text";
            }
        }
        // 2. Klasik ≈ûifreler (Mod Se√ßimi Pasif)
        else {
            modeSelect.disabled = true;
            keyInput.removeAttribute("maxlength");

            if(algo === 'sezar') {
                hint.innerText = "Kaydƒ±rma miktarƒ± (Sayƒ± girin).";
                keyInput.placeholder = "√ñrn: 3";
                keyInput.type = "number";
            }
            else if(algo === 'vigenere') {
                hint.innerText = "Anahtar kelime girin (Sadece Harf).";
                keyInput.placeholder = "√ñrn: ANAHTAR";
                keyInput.type = "text";
            }
            else if(algo === 'affine') {
                hint.innerText = "a,b formatƒ±nda girin.";
                keyInput.placeholder = "√ñrn: 5,8";
                keyInput.type = "text";
            }
            else if(algo === 'rail_fence') {
                hint.innerText = "Ray sayƒ±sƒ± (Sayƒ± girin).";
                keyInput.placeholder = "√ñrn: 3";
                keyInput.type = "number";
            }
            else if(algo === 'substitution') {
                hint.innerText = "26 harflik karƒ±≈üƒ±k alfabe.";
                keyInput.placeholder = "√ñrn: QWERTY...";
                keyInput.type = "text";
            }
            else if(algo === 'columnar') {
                hint.innerText = "Anahtar kelime girin.";
                keyInput.placeholder = "√ñrn: COLUMN";
                keyInput.type = "text";
            }
            else if(algo === 'hill') {
                hint.innerText = "Matris elemanlarƒ±nƒ± bo≈ülukla girin (4 sayƒ±=2x2, 9 sayƒ±=3x3).";
                keyInput.placeholder = "√ñrn: 6 24 1 13";
                keyInput.type = "text";
            }
        }
    }

    async function performEncrypt() {
        const algo = document.getElementById('algorithm').value;
        const mode = document.getElementById('mode').value;
        const text = document.getElementById('text').value;
        const key = document.getElementById('key').value;
        const sendBtn = document.getElementById('sendBtn');
        const cipherRes = document.getElementById('cipher-result');
        const encKeyRes = document.getElementById('enc-key-result');

        sendBtn.disabled = true;

        // RSA kalktƒ±ƒüƒ± i√ßin artƒ±k anahtar zorunlu
        if(!key) {
            alert("L√ºtfen bir anahtar giriniz.");
            return;
        }
        if(!text) {
            alert("L√ºtfen ≈üifrelenecek metni giriniz.");
            return;
        }

        try {
            const response = await fetch('/encrypt', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    algorithm: algo, 
                    mode: mode, 
                    text: text, 
                    key: key 
                })
            });

            const result = await response.json();
            const resArea = document.getElementById('result-area');
            
            resArea.style.display = 'block';
            
            if (result.status === 'success') {
                cipherRes.innerText = result.ciphertext;
                currentCiphertext = result.ciphertext;
                
                // Hibrit Anahtar (Varsa G√∂ster)
                if(result.encrypted_key) {
                    currentEncryptedKey = result.encrypted_key;
                    encKeyRes.innerText = result.encrypted_key.substring(0, 50) + "...";
                    document.getElementById('enc-key-row').style.display = 'flex';
                } else {
                    currentEncryptedKey = null;
                    document.getElementById('enc-key-row').style.display = 'none';
                }

                sendBtn.disabled = false;
                
                document.getElementById('server-status').innerText = "Bekleniyor...";
                document.getElementById('server-plaintext').innerText = "-";
            } else {
                cipherRes.innerHTML = `<span class="status-error">${result.message}</span>`;
                sendBtn.disabled = true;
            }
        } catch (error) {
            alert("Bir hata olu≈ütu: " + error);
        }
    }

    async function sendToServer() {
        const algo = document.getElementById('algorithm').value;
        const mode = document.getElementById('mode').value;
        const statusSpan = document.getElementById('server-status');
        const plainSpan = document.getElementById('server-plaintext');
        const sendBtn = document.getElementById('sendBtn');

        statusSpan.innerText = "Server bekleniyor...";
        sendBtn.disabled = true;
        
        try {
            const response = await fetch('/send_to_server', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    algorithm: algo, 
                    mode: mode,
                    ciphertext: currentCiphertext,
                    encrypted_key: currentEncryptedKey
                })
            });

            const result = await response.json();
            
            if (result.status === 'success') {
                statusSpan.innerHTML = '<span class="status-success">‚úì DE≈ûƒ∞FRELEME BA≈ûARILI</span>';
                plainSpan.innerText = result.plaintext;
            } else {
                statusSpan.innerHTML = '<span class="status-error">‚úñ BA≈ûARISIZ</span>';
                plainSpan.innerText = result.message || "Hata olu≈ütu";
            }
        } catch (error) {
            statusSpan.innerText = "Hata: Server ile ileti≈üim kurulamadƒ±.";
        } finally {
            sendBtn.disabled = false;
        }
    }
</script>

</body>
</html>